(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t,n){var r=t.data,o=t.handleCardClick,i=t.handleLikeClick,a=t.handleRemoveClick,c=t.renderDeleteButton,u=t.likeButtonState,l=t.handleDeleteIconClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardData=r,this._templateCard=document.querySelector(n).content.querySelector(".card"),this._handleCardClick=o,this._handleRemoveClick=a,this._handleLikeClick=i,this._renderDeleteButton=c,this._likeButtonState=u,this._handleDeleteIconClick=l}var n,r;return n=e,(r=[{key:"_deletePopup",value:function(){this._cardElement.remove()}},{key:"removeCard",value:function(){this._cardElement.remove(),this._cardElement=null}},{key:"_like",value:function(){this._handleLikeClick(this._cardData,this._cardElement)}},{key:"_removeDeleteButton",value:function(){this._deleteButton=this._cardElement.querySelector(".card__button-delete"),this._renderDeleteButton(this._deleteButton)}},{key:"_removeLike",value:function(){this._likeButton.classList.remove("card__button-like_active"),this._handleRemoveClick(this._cardData)}},{key:"renderCard",value:function(){var t=this;return this._cardElement=this._templateCard.cloneNode(!0),this._cardElement.querySelector(".card__title").textContent=this._cardData.name,this._cardImg=this._cardElement.querySelector(".card__image"),this._cardImg.src=this._cardData.link,this._cardImg.addEventListener("click",(function(e){return t._handleCardClick(t._cardData)})),this._likesArr=this._cardData.likes,this._likeButton=this._cardElement.querySelector(".card__button-like"),this._likeButtonState(this._cardData,this._likeButton,this._cardElement),this._likeButton.addEventListener("click",(function(){return t._like()})),this._removeDeleteButton(),this._deleteButton.addEventListener("click",(function(){return t._handleDeleteIconClick(t._cardData)})),this._cardElement}}])&&t(n.prototype,r),e}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._hideError=function(t){r._errorElement=r._form.querySelector("#".concat(t.name,"-error")),t.classList.remove(r._errorClass),r._errorElement.textContent=""},this._showError=function(t){r._errorElement=r._form.querySelector("#".concat(t.name,"-error")),r._errorElement.textContent=t.validationMessage,t.classList.add(r._errorClass)},this._checkInputValidity=function(t){t.checkValidity()?r._hideError(t):r._showError(t)},this.toggleButtonState=function(){r._form.checkValidity()?(r._buttonElement.classList.remove(r._inactiveButtonClass),r._buttonElement.disabled=!1):(r._buttonElement.classList.add(r._inactiveButtonClass),r._buttonElement.disabled=!0)},this._setEventListeners=function(){r._inputElements=Array.from(r._form.querySelectorAll(r._inputSelector)),r._buttonElement=r._form.querySelector(r._submitButtonSelector),r._inputElements.forEach((function(t){t.addEventListener("input",(function(e){r._checkInputValidity(t),r.toggleButtonState(r._buttonElement)})),r.toggleButtonState(r._buttonElement)}))},this._form=e,this._formSelector=n.formSelector,this._inputSelector=n.inputSelector,this._submitButtonSelector=n.submitButtonSelector,this._errorClass=n.errorClass,this._inactiveButtonClass=n.inactiveButtonClass}var e,r;return e=t,(r=[{key:"enableValidation",value:function(){this._form.addEventListener("submit",(function(t){t.preventDefault()})),this._setEventListeners(this._form)}}])&&n(e.prototype,r),t}();function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=document.querySelector(e)}var e,n;return e=t,(n=[{key:"setItem",value:function(t){this._container.prepend(t)}}])&&o(e.prototype,n),t}(),a=document.querySelector(".popup_type_edit-profile"),c=document.querySelector(".popup_type_add-card"),u=document.querySelector(".popup_type_image"),l=(document.querySelector(".popup_type_update-avatar"),document.querySelector(".popup_type_confirm")),s=document.querySelector(".popup_type_update-avatar"),f=document.querySelector(".edit-button"),p=document.querySelector(".add-button"),h=document.querySelector(".profile__avatar-edit"),d=document.forms.edit,_=document.forms.add,y=document.forms.avatar,m=(document.querySelector(".template-card").querySelector(".card__button-delete"),{formSelector:".form",inputSelector:".popup__item",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"error",errorClass:"popup__item_invalid"});function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var b=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=e,this.handleEscClose=this.handleEscClose.bind(this),this.handleOverlayClose=this.handleOverlayClose.bind(this)}var e,n;return e=t,(n=[{key:"handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"handleOverlayClose",value:function(t){t.target===t.currentTarget&&this.close()}},{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this.handleEscClose),this._popup.addEventListener("click",this.handleOverlayClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this.handleEscClose),this._popup.removeEventListener("click",this.handleOverlayClose)}},{key:"setEventListeners",value:function(){var t=this;this._popup.querySelector(".popup__close-icon").addEventListener("click",(function(){return t.close()}))}}])&&v(e.prototype,n),t}();function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function E(t,e){return(E=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&E(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(r);if(o){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return C(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._popup=t,e}return e=a,(n=[{key:"open",value:function(t){g(w(a.prototype),"open",this).call(this),this._popup.querySelector(".popup__subtitle").textContent=t.name;var e=this._popup.querySelector(".popup__image");e.src=t.link,e.alt="Изображение: "+t.name}}])&&S(e.prototype,n),a}(b);function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var j=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._userName=document.querySelector(e),this._userInfo=document.querySelector(n)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._userName.textContent,job:this._userInfo.textContent}}},{key:"setUserInfo",value:function(t,e){this._userName.textContent=t,this._userInfo.textContent=e}}])&&L(e.prototype,n),t}();function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function D(t,e,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=R(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function I(t,e){return(I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&I(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=R(r);if(o){var n=R(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function a(t){var e,n=t.popupSelector,r=t.handleFormSubmit;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,n))._popup=n,e._handleFormSubmit=r,e}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._inputList=this._popup.querySelectorAll(".popup__item"),this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;D(R(a.prototype),"setEventListeners",this).call(this),this._popup.querySelector(".form").addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues())}))}},{key:"close",value:function(){D(R(a.prototype),"close",this).call(this),this._popup.querySelector(".form").reset()}}])&&P(e.prototype,n),a}(b);function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var A=function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))},V=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.url,this._token=e.token}var e,n;return e=t,(n=[{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/cards"),{method:"GET",headers:{authorization:this._token}}).then(A)}},{key:"addCard",value:function(t){return fetch("".concat(this._url,"/cards/"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then(A)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(A)}},{key:"likeCard",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token}}).then(A)}},{key:"removeLikeCard",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(A)}},{key:"updateAvatar",value:function(t){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(A)}},{key:"getProfileInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:{authorization:this._token}}).then(A)}},{key:"setProfileInfo",value:function(t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.job})}).then(A)}}])&&x(e.prototype,n),t}();function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=G(r);if(o){var n=G(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return J(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._popup=t,e}return e=a,(n=[{key:"setSubmitAction",value:function(t){this._handleSubmitCallback=t}},{key:"setEventListeners",value:function(){var t=this;N(G(a.prototype),"setEventListeners",this).call(this),this._popup.querySelector(".form").addEventListener("submit",(function(e){e.preventDefault(),t._handleSubmitCallback()}))}}])&&U(e.prototype,n),a}(b);function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $=new r(d,m);$.enableValidation();var K=new r(_,m);K.enableValidation();var Q=new r(y,m);function W(t,e){var n=e?"Сохранение...":t!==c?"Сохранить":"Создать";return t.querySelector(".popup__save-button").textContent=n}Q.enableValidation();var X=new O(u);X.setEventListeners();var Y=new i(".cards"),Z=new V({url:"https://mesto.nomoreparties.co/v1/cohort-18",token:"e9b15767-4b50-4f24-9b84-b0128a0d1268"});Promise.all([Z.getProfileInfo(),Z.getInitialCards()]).then((function(t){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}}(n,r)||function(t,e){if(t){if("string"==typeof t)return M(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1];function d(t){var n=function(){return t.likes.find((function(t){return t._id===i._id}))},r=new e({data:t,handleCardClick:function(t){!function(t){X.open(t)}(t)},handleLikeClick:function(e,r){n()?Z.removeLikeCard(e._id).then((function(e){r.querySelector(".card__button-like").classList.remove("card__button-like_active"),r.querySelector(".card__button-likes-counter").textContent=e.likes.length,t.likes.pop(i)})).catch((function(t){return"Ошибка: "+t})):Z.likeCard(e._id).then((function(t){r.querySelector(".card__button-like").classList.add("card__button-like_active"),r.querySelector(".card__button-likes-counter").textContent=t.likes.length,e.likes.push(i)})).catch((function(t){return"Ошибка: "+t}))},likeButtonState:function(t,e,r){function o(){r.querySelector(".card__button-likes-counter").textContent=t.likes.length}n()?(o(),e.classList.add("card__button-like_active")):(o(),e.classList.remove("card__button-like_active"))},renderDeleteButton:function(e){i._id===t.owner._id||e.remove()},handleDeleteIconClick:function(t){var e=new H(l);e.setSubmitAction((function(){Z.deleteCard(t._id).then((function(t){r.removeCard(),e.close()})).catch((function(t){return console.log("Ошибка: "+t)}))})),e.setEventListeners(),e.open()}},".template-card");Y.setItem(r.renderCard())}document.querySelector(".profile__avatar").src=i.avatar,document.querySelector(".profile__avatar").alt=i.name,document.querySelector(".profile-info__title").textContent=i.name,document.querySelector(".profile-info__subtitle").textContent=i.about;var _=new T({popupSelector:s,handleFormSubmit:function(t){W(s,!0),Z.updateAvatar(t.link).then((function(t){Z.getProfileInfo(),document.querySelector(".profile__avatar").src=t.avatar})).finally((function(){W(s,!1),_.close()})).catch((function(t){return console.log("Ошибка: "+t)}))}});_.setEventListeners(),h.addEventListener("click",(function(){Q.toggleButtonState(),_.open()}));var y,m=new j(".profile-info__title",".profile-info__subtitle"),v=new T({popupSelector:a,handleFormSubmit:function(t){W(a,!0),Z.setProfileInfo(t).then((function(){v.close(),W(a,!1)})),m.setUserInfo(t.name,t.job)}});v.setEventListeners(),f.addEventListener("click",(function(){m.getUserInfo(),document.forms.edit.name.value=m.getUserInfo().name,document.forms.edit.job.value=m.getUserInfo().job,$.toggleButtonState(),v.open()})),console.log(u),u.sort((y="createdAt",function(t,e){return t[y]>e[y]?1:-1})).forEach((function(t){return d(t)}));var b=new T({popupSelector:c,handleFormSubmit:function(t){W(c,!0),Z.addCard(t).then((function(t){d(t),Z.getInitialCards(),b.close(),W(c,!1)})).catch((function(t){return console.log("Ошибка: "+t)}))}});b.setEventListeners(),p.addEventListener("click",(function(){K.toggleButtonState(),b.open()}))})).catch((function(t){console.log(t)}))})();